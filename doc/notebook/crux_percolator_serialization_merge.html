<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OOo-dev 2.0  (Linux)">
	<META NAME="CREATED" CONTENT="20070611;14101900">
	<META NAME="CHANGED" CONTENT="20070810;19354300">
	<STYLE>
	<!--
		@page { size: 8.5in 11in; margin: 0.79in }
		P { margin-bottom: 0.08in }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P STYLE="margin-bottom: 0in"><CODE><B><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Percolator
incorporation</FONT></FONT></B></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">The
database search and Percolator interface are decoupled by
'match_search' and 'match_analysis'.</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">'match_search'
performs a database search for each spectra then outputs the result
in <CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">a
serialized binary file format and </FONT></FONT></CODE>an optional
human-readable format(sqt). 'match_analysis' will read in the
serialized binary output files from 'match_search' and generate run
specific features that can be passed over to Percolator.</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">rich_match
and rich_match_collection are now all included int match &amp;
match_collection.</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">The general serialization order is the
following</P>
<UL>
	<P STYLE="margin-bottom: 0in"></P>
	<LI><P STYLE="margin-bottom: 0in">1. serialize_header</P>
	<LI><P STYLE="margin-bottom: 0in">2. serialize_psm_features</P>
	<LI><P STYLE="margin-bottom: 0in">3.
	serialize_total_number_of_spectra</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<OL>
	<LI><P STYLE="margin-bottom: 0in">serialize_header is a method in
	match_collection</P>
	<P STYLE="margin-bottom: 0in">It serializes the .ms2 file features.</P>
	<P STYLE="margin-bottom: 0in">Serializes the header information for
	the binary PSM serialized files.</P>
</OL>
<P STYLE="margin-bottom: 0in">/**</P>
<P STYLE="margin-bottom: 0in"> * &lt;int: number spectra&gt; &lt;--this
will be over written by serialize_total_number_of_spectra method</P>
<P STYLE="margin-bottom: 0in"> * &lt;int: number of spectrum
features&gt;</P>
<P STYLE="margin-bottom: 0in"> * &lt;int: number of top ranked
peptides serialized per spectra&gt;</P>
<P STYLE="margin-bottom: 0in"> * //FIXME not added at the moment
&lt;int: ms2 file length&gt;&lt;char*: ms2 filename&gt; 
</P>
<P STYLE="margin-bottom: 0in"> * //FIXME not added at the moment
&lt;int: fasta file length&gt;&lt;char*: fasta filename&gt;</P>
<P STYLE="margin-bottom: 0in"> *</P>
<P STYLE="margin-bottom: 0in"> */</P>
<P STYLE="margin-bottom: 0in">BOOLEAN_T serialize_header(</P>
<P STYLE="margin-bottom: 0in">  SPECTRUM_COLLECTION_T*
spectrum_collection, ///&lt; the spectrum_collection -in</P>
<P STYLE="margin-bottom: 0in">  char* fasta_file, ///&lt; the fasta
file 
</P>
<P STYLE="margin-bottom: 0in">  FILE* psm_file ///&lt; the file to
serialize the header information -out</P>
<P STYLE="margin-bottom: 0in">  );</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Serialize
the match and spectrum features of the PSM</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">void
serialize_psm_features(</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">FILE*
output, //&lt; PSM database output file</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">int
output_rank, ///&lt; the top peptides to be serialized.</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
match_collection </FONT></FONT></SPAN><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//&lt;
match_collection features to be serialized</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">)
</FONT></FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<OL START=2>
	<LI><P STYLE="margin-bottom: 0in">serialize_psm_features</P>
	<P STYLE="margin-bottom: 0in">Serializes the PSM features of the
	specific spectrum in the ms2 file</P>
	<P STYLE="margin-bottom: 0in">upto 'top_match' number of  top
	peptides among the match_collection are serlized</P>
</OL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"> 	* first, serialize the specific
spectrum info of the match collection    
</P>
<P STYLE="margin-bottom: 0in"> 	* Second, iterate over matches and
serialize the structs</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">  /*</P>
<P STYLE="margin-bottom: 0in">   *&lt;int: charge state of the
spectrum&gt;</P>
<P STYLE="margin-bottom: 0in">   *&lt;int: The total match objects in
the match_collection searched with the spectrum</P>
<P STYLE="margin-bottom: 0in">   *&lt;float: delta_cn&gt;</P>
<P STYLE="margin-bottom: 0in">   *&lt;float: ln_dleta_cn&gt;</P>
<P STYLE="margin-bottom: 0in">   *&lt;float: ln_experiment_size&gt;</P>
<P STYLE="margin-bottom: 0in">   *&lt;BOOLEAN_T: did the score type
been scored?&gt;* &lt;- for all score types</P>
<P STYLE="margin-bottom: 0in">   *&lt;MATCH: serialize match struct&gt;
*&lt;--serialize match structs upto top-match # ranks</P>
<P STYLE="margin-bottom: 0in">   */</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">		MATCH serialization format is 
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">		/*</P>
<P STYLE="margin-bottom: 0in">		 * &lt;PEPTIDE_T: serialize peptide&gt;</P>
<P STYLE="margin-bottom: 0in"> 		 * &lt;float: score&gt;&lt;int:
ranking&gt;* &lt;--serialize for all score types</P>
<P STYLE="margin-bottom: 0in">		 * &lt;SPECTRUM_T: serilize spectrum&gt;</P>
<P STYLE="margin-bottom: 0in"> 		 * &lt;float: b_y ion match ratio
for SP&gt;</P>
<P STYLE="margin-bottom: 0in"> 		 * &lt;PEPTIDE_TYPE_T: the peptide
type over-all peptide srcs&gt;</P>
<P STYLE="margin-bottom: 0in"> 		 * &lt;BOOLEAN_T: is this a null
peptide?&gt;</P>
<P STYLE="margin-bottom: 0in"> 		 */</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">3.
	serialize_total_number_of_spectra</P>
	<LI><P STYLE="margin-bottom: 0in"></P>
	<LI><P STYLE="margin-bottom: 0in">  Modifies the serialized header
	information for the binary PSM serialized files</P>
	<LI><P STYLE="margin-bottom: 0in">  Sets the total number of spectra
	serialized in the file</P>
	<LI><P STYLE="margin-bottom: 0in">  Assumes the first field in the
	file is the number total spectra serialized</P>
	<LI><P STYLE="margin-bottom: 0in">  Must be run after
	serialize_header</P>
	<LI><P STYLE="margin-bottom: 0in">  Thus, updates the very first
	field &lt;int: number spectra&gt; in 1. serialize_header.</P>
	<LI><P STYLE="margin-bottom: 0in">   This value is used later when
	parsing to know how many spectra to parse.</P>
	<LI><P STYLE="margin-bottom: 0in"> 
	</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">/***************</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">*
match_search.c</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">***************/</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection;</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">int
output_top_rank = 5 </FONT></FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">FILE*
output_sqt;</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//get
psm_result file handler array</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//this
includes one for the target and for the decoys</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">FILE**
output_files = get_spectrum_collection_psm_result_filename</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">get_output_file(p</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">sm_result_folder);</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">serialize_header(collection,
fasta_file, psm_result_file[file_idx]);</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
spectrum:</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//generates
a match_collection from the spectrum </FONT></FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection
= new_</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection(spectrum);</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//serialize
the PSM's match &amp; spectrum features to output file up to
output_top_rank </FONT></FONT></SPAN></CODE></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">serialize_psm_features(<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">output_file</FONT></FONT></SPAN></CODE>,
output_top_rank, </FONT></FONT></SPAN><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection);</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Also
output PSMs in sqt file</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">print_match_collection_sqt(output_sqt,
top_match, match_collection);</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//free
match_collection</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">free(</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection)</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">serialize_total_number_of_spectra</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">/******************</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">*
match_analysis.c</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">*******************/</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">//use MATCH_COLLECTION_ITERATOR_T to
parse both target and decoy match collections</P>
<P STYLE="margin-bottom: 0in">// creates one match collection per
set, each set is collection of top ranked PSM for each spectra.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//create
<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T</FONT></FONT></SPAN></CODE>
object and read in the output PSM results.</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection</FONT></FONT></SPAN></CODE></FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//create
iterator, to register each PSM feature to Percolator</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_ITERATOR_T*
match_iterator = new_match_iterator(match_collection</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">);</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
match in </FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_iterator:</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Register
PSM with features to Percolator</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">pcRegisterPSM(get<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">_match_</FONT></FONT></SPAN></CODE>sequence(<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match</FONT></FONT></SPAN></CODE>),
get_match_percolator_features(<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match</FONT></FONT></SPAN></CODE>));</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P><BR><BR>
</P>
</BODY>
</HTML>