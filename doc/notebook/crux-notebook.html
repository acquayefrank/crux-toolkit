<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.1.2  (Linux)">
	<META NAME="CREATED" CONTENT="20061107;18085800">
	<META NAME="CHANGED" CONTENT="20061107;18545700">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<HR>
<P><BR><CODE><B><FONT FACE="Courier, monospace">CRUX notebook </FONT></B></CODE>
</P>
<HR>
<P><BR><BR><BR><CODE><B><FONT FACE="Courier, monospace">
Purpose:
</FONT></B></CODE><BR><BR>
To test P vs. q for analytic p-values.
</FONT></B></CODE><BR><Br><CODE><B><FONT FACE="Courier, monospace">Results:
</FONT></B></CODE>
<br>
<img src="./Images/q-value.png">
</P>
<P><CODE><B><FONT FACE="Courier, monospace">Discussion: </FONT></B></CODE>
</P>
<br>
A pronounced stairstep effect, the origin of which is a mystery. It is
reproducible from raw p-values by hand (i.e. from the python command line)
so maybe it is a conceptual error on my part?
<P STYLE="margin-bottom: 0in"><BR><CODE><B><FONT FACE="Courier, monospace">
</FONT></B></CODE>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P><BR><BR>
</P>
<P><BR><CODE><B><FONT FACE="Courier, monospace">November 7, 2006
</FONT></B></CODE><BR><BR><CODE><B><FONT FACE="Courier, monospace">Purpose:
</FONT></B></CODE><BR><BR>Try implementing the new proposed SP
scoring method described <A HREF="sp_scoring_method.html">here.</A><BR>make
modifications if necessary to approach Sequest sp scores.</P>
<P><BR><CODE><B><FONT FACE="Courier, monospace">Methods: </FONT></B></CODE><BR>1.
I tried the sp scoring as proposed, <A HREF="sp_scoring_method.html">here</A>.</P>
<P>2. I increased the interval of the intensity_sum to +/- 2m/z.</P>
<P>3. Instead of adding all intensities in the window of +/-2m/z, add
only the maximum intensity peak, add deleted the BETA constant in the
Sp scoring function. <BR><BR><CODE><B><FONT FACE="Courier, monospace">Results:
</FONT></B></CODE>
</P>
<P>Method 1. did not work, the sp scores were generally too small
compared to Sequest. The main reason I suspect is because the total
count of matched fragmented ions were smaller than what Sequest
reports in the output file. Thus, I decided to increase the mass/z
window to +/- 2 m/z. The window of +/- 2m/z is consistent to my
experiments shifting peaks around and observing the matched peak
count. Finally, the match peak count is consistent with Sequest,
however the Sp scores are too large now. I tried averaging the peaks
within the window of +/- 2m/z which still too large. The final
combination that seems to fit best with Sequest is to use only the
maximum intensity peak with in +/- 2m/z, and delete the (1+beta*n)
portion of the equation. The resulting plot is shown bellow. <BR><BR><IMG SRC="images/Sequest-vs-CRUX-for-sp_window5_only_max_intensity.png" NAME="Graphic4" ALIGN=BOTTOM WIDTH=576 HEIGHT=432 BORDER=0></P>
<P>Firgure.1 using a different .spt file which contained more spread
Sp scores to compare. 
</P>
<P>I got this file from Aaron, var/noble.</P>
<P><BR><IMG SRC="images/Sequest-vs-CRUX-for-sp_window5_max_inten.png" NAME="Graphic4" ALIGN=BOTTOM WIDTH=576 HEIGHT=432 BORDER=0></P>
<P>Figure 2. the original .sqt file which I used on October 31
experiments.</P>
<P><CODE><B><FONT FACE="Courier, monospace">Discussion &amp;
<CODE><FONT FACE="Courier, monospace">Conclusion</FONT></CODE>: </FONT></B></CODE>
</P>
<UL>
	<LI><P>The Sp scores are still not perfect, but much improved. 
	</P>
	<LI><P>I have noticed that there are some discrepancies with matched
	peak count with Sequest, which all peaks I believe should have been
	added.</P>
	<LI><P>Still mystery how unmatched peaks effect SP score. I have
	noticed Sequest prints the total intensity sum on the output file. 
	Maybe Sequest uses the total intensity somehow...</P>
</UL>
<HR>
<P><BR><CODE><B><FONT FACE="Courier, monospace">October 31, 2006
</FONT></B></CODE><BR><BR><CODE><B><FONT FACE="Courier, monospace">Purpose:
</FONT></B></CODE><BR><BR>To reverse engineer the sp scores from
Sequest <BR><BR><CODE><B><FONT FACE="Courier, monospace">Methods: </FONT></B></CODE><BR><BR>I
have plot the sp scores from CRUX's score_peptide_spectrum vs Sequest
sp scores.<BR><BR>Current method of scoring Sp, 1. process observed
spectrum <BR><BR><CODE><B><FONT FACE="Courier, monospace">Results:
</FONT></B></CODE><BR><BR><IMG SRC="images/Sequest-vs-CRUX-for-sp_before.png" NAME="Graphic1" ALIGN=BOTTOM WIDTH=576 HEIGHT=432 BORDER=0>
<BR><BR>No normalization, there seems to be no correlation <BR><BR><IMG SRC="images/Sequest_Xcore_rank-vs-CRUX-for-sp.png" NAME="Graphic2" ALIGN=BOTTOM WIDTH=576 HEIGHT=432 BORDER=0>
<BR><BR>The Xcore rank vs CRUX score, no normalization Just to check
if my method might be better, I have plotted it against the Xscore
ranking. The result should show a negative slop, however it is not
the case. Thus, need to improve my sp score. <BR><BR><IMG SRC="images/Sequest-vs-CRUX-for-sp_norm_100.png" NAME="Graphic3" ALIGN=BOTTOM WIDTH=576 HEIGHT=432 BORDER=0>
<BR><BR>Normalized all the peaks to 100, by dividing with the max
intensity peak This seems to improve the sp correlation to Sequest.,
however still most values are too low. <BR><BR><IMG SRC="images/Sequest-vs-CRUX-for-sp_norm_100_norm_1.png" NAME="Graphic4" ALIGN=BOTTOM WIDTH=576 HEIGHT=432 BORDER=0>
<BR><BR>First, remove 10u around the precursor ion, then normalize
+/- 1u around each peak to the highest peak, finally normalize all
the peaks to 100. Definatlly, seems to improve scoring. <BR><BR><CODE><B><FONT FACE="Courier, monospace">Discussion:
</FONT></B></CODE>
</P>
<P>1.&nbsp; Process observed spectrum</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">All peaks location(m/z) are
	rounded to the nearest integer, although kept as float &nbsp;</P>
	<LI><P STYLE="margin-bottom: 0in">Keep the top 200 abundant peaks,
	remove others</P>
	<LI><P STYLE="margin-bottom: 0in">remove +/- 5u around the precursor
	ion</P>
	<LI><P>equalize the peaks to the highest peak within +/- 1u&nbsp;</P>
</UL>
<P>2.&nbsp; Predict fragment ions, B and Y ions, use precursor ion
charge as (charge - 1) .</P>
<P>3.&nbsp; For each predicted ion, add all intensities of peaks that
have a m/z within +/- 1u of the fragmented ion in the processed
observed spectrum.</P>
<P>4. Normalize the peaks to 100, this could be done in step 1, but
more efficiently done by dividing the summation of the intensities by
the maximum intensity peak in the observed spectrum, than multiplying
by 100.</P>
<P>5. Calculate Sp,</P>
<P>&nbsp; <FONT FACE="courier new, monospace">Sp =
Normalized_intensity_sum * <I>n</I>i * (1 + m*BETA) * (1 +
k*GAMMA)/<I>n</I>t &nbsp;&nbsp; &nbsp;</FONT></P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <I>n</I>i&nbsp; = the number
of predicted fragment ions that match have a matching peak within +/-
1 in the observed spectrum.</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <I>n</I>t = the total number
of predicted fragmented ions</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; m = continuity count of an
ion series, ex, if B2 B3 B4 Y3 Y4 match, than m=3</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; k = the existence of
immonium ion for amino acid, H,Y,W,M,F. Currently always set to 0.</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BETA, GAMMA = constants</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Observations &amp; thoughts</P>
<OL>
	<LI><P STYLE="margin-bottom: 0in">Increasing the summation window
	did not help the distribution in my current implementation.</P>
	<P STYLE="margin-bottom: 0in">Although, Sequest seems to be adding
	ions within +/- 2.5u, instead of 1u as stated in the paper.</P>
	<LI><P STYLE="margin-bottom: 0in">In Sequest, when the precursor ion
	m/z is 802.65, removing ions of interval between 787.7 and 817.6
	does not change both Sp and Xcore.</P>
	<P STYLE="margin-bottom: 0in">This is +/- 15u, which in the paper
	state it removes an interval of 10u. Thus, from result of 1, seems
	like Sequest uses some kind of bin that is a size of 5u, such that 
	</P>
	<P STYLE="margin-bottom: 0in">the removing window is 10u + the bin
	size (which upper and lower limit is included).</P>
	<LI><P STYLE="margin-bottom: 0in">Sequest states, multi-charged
	fragmented ions are not considered in the scoring routine. 
	</P>
	<P STYLE="margin-bottom: 0in">However, the output file for
	multi-charge(z) precursor ions clear shows that all charged
	fragmented ions are used up to z-1.</P>
	<LI><P STYLE="margin-bottom: 0in">Adding a peak that has the same
	rounded integer m/z to the observed spectrum that has a matching
	fragmented ion does not change the Sequest score.</P>
	<OL>
		<OL>
			<OL>
				<OL>
					<P STYLE="margin-bottom: 0in">m/z intensity</P>
				</OL>
			</OL>
		</OL>
		<P STYLE="margin-bottom: 0in">for ex, 654.2 1.1 &lt;- original
		match 
		</P>
		<OL>
			<OL>
				<OL>
					<P STYLE="margin-bottom: 0in">654.2 1.1 &lt;- peaks added</P>
					<P STYLE="margin-bottom: 0in">654.3 1.1 &lt;- peaks added</P>
				</OL>
			</OL>
		</OL>
	</OL>
</OL>
<P STYLE="margin-bottom: 0in">Sp score unchanged.</P>
<OL>
	<OL>
		<OL>
			<OL>
				<OL>
					<P STYLE="margin-bottom: 0in">m/z intensity</P>
				</OL>
			</OL>
		</OL>
		<P STYLE="margin-bottom: 0in">for ex, 654.2 1.1 &lt;- original
		match 
		</P>
		<OL>
			<OL>
				<OL>
					<P STYLE="margin-bottom: 0in">654.3 3.1 &lt;- peaks added</P>
					<P STYLE="margin-bottom: 0in">654.4 4.1 &lt;- peaks added</P>
					<P STYLE="margin-bottom: 0in">654.5 5.1 &lt;- peaks added</P>
				</OL>
			</OL>
		</OL>
	</OL>
</OL>
<P STYLE="margin-bottom: 0in">Sp score equals just having listed one
peak, 
</P>
<P STYLE="margin-bottom: 0in">654.5 5.1, which has the largest
intensity</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">=&gt; Probably, merging all the peaks
within 1u, to one peak that has the largest m/z</P>
<P STYLE="margin-bottom: 0in">The exact interval is, if x.7 &lt;= y &lt;
x.6, y is converted to x. 
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<OL START=5>
	<LI><P STYLE="margin-bottom: 0in">Mysteries of Sequest,</P>
</OL>
<P STYLE="margin-bottom: 0in">654.2 1.1 &lt;- original match 
</P>
<P STYLE="margin-bottom: 0in">657.2 1.1 &lt;- add this peak</P>
<P STYLE="margin-bottom: 0in">686.7 3.8</P>
<P STYLE="margin-bottom: 0in">690.7 4.5</P>
<P STYLE="margin-bottom: 0in">691.5 2.8</P>
<P STYLE="margin-bottom: 0in">696.1 2.7 
</P>
<P STYLE="margin-bottom: 0in">697.3 1.4</P>
<P STYLE="margin-bottom: 0in">Causes Sequest to no longer call a
fragmented ion with 695.7 m/z a match</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Another case, 
</P>
<P STYLE="margin-bottom: 0in">even though there was a peak,</P>
<P STYLE="margin-bottom: 0in">728.4 1.9</P>
<P STYLE="margin-bottom: 0in">in the observed spectrum, and a
fragmented ion with 728.28 m/z</P>
<P STYLE="margin-bottom: 0in">Sequest did no call it a match...
strange</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P><BR><BR><CODE><B><FONT FACE="Courier, monospace">Conclusion: </FONT></B></CODE>
</P>
<HR>
<P><BR><BR>
</P>
</BODY>
</HTML>
