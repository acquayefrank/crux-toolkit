<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OOo-dev 2.0  (Linux)">
	<META NAME="CREATED" CONTENT="20061103;11522100">
	<META NAME="CHANGED" CONTENT="20061212;19214100">
	<STYLE>
	<!--
		@page { size: 8.27in 11.69in; margin: 0.79in }
		P { margin-bottom: 0.08in }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<HR>
<P><CODE><B><FONT SIZE=4><FONT FACE="Courier, monospace">Proposed Sp
scoring method</FONT></FONT></B></CODE></P>
<P>1.&nbsp; Process observed spectrum</P>
<OL>
	<OL>
		<LI><P STYLE="margin-bottom: 0in">Remove peaks with m/z that are
		greater than experimental_mass + 50</P>
		<LI><P STYLE="margin-bottom: 0in">Remove peaks within +/- 15 m/z of
		the precursor ion.</P>
		<LI><P STYLE="margin-bottom: 0in">Square root the intensity of all
		peaks.</P>
		<LI><P STYLE="margin-bottom: 0in">All peak's location(m/z) are
		rounded to the nearest integer by<BR>new_m/z = int( old_m/z /
		bin_width + 0.5 ), bin_width = 1.0005079 m/z for mono mass,
		1.0011413 for average mass.<BR>If there are multiple peaks with the
		same rounded integer m/z, choose only the max intensity peak and
		remove the smaller peaks.</P>
		<LI><P STYLE="margin-bottom: 0in">Normalize the peaks' intensity to
		100, so that the max peak intensity equals 100.</P>
		<LI><P STYLE="margin-bottom: 0in">Smooth peaks' intensity with
		formula.</P>
		<OL TYPE=a>
			<P STYLE="margin-bottom: 0in">&forall;<FONT FACE="courier new, monospace">i
			&isin; m/z in array s(including peaks and non peaks), s[i] =
			intensity,</FONT></P>
			<P STYLE="margin-bottom: 0in"><FONT FACE="courier new, monospace">construct
			new array s1' such that, <BR><SPAN STYLE="background: #ffffff"><FONT COLOR="#000000">s1'[i]
			= <SPAN STYLE="background: #ffffff"><FONT COLOR="#000000">(s[i-2]
			+ 4*s[i-1] + 6*s[i] + 4*s[i+1] + s[i+2])/16</FONT></SPAN> </FONT></SPAN></FONT>
			</P>
			<P STYLE="margin-bottom: 0in"><FONT COLOR="#000000"><FONT FACE="courier new, monospace"><SPAN STYLE="background: #ffffff">replace
			s with s1' as new spectrum array.</SPAN></FONT></FONT></P>
		</OL>
		<LI><P STYLE="margin-bottom: 0in">&ldquo;Zero peak &amp; extract&rdquo;</P>
		<OL TYPE=a>
			<P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">i
			m/z in array, s[i] = intensity (s is now the new spectrum array
			from step 6)</FONT></P>
			<P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">construct
			a new array s2' by extracting peaks from s.</FONT></P>
			<LI><P STYLE="margin-bottom: 0in">&forall;<FONT FACE="courier new, monospace">i
			&isin; m/z in array s,</FONT></P>
			<P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">compute
			the intensity &sigma;,&micro; in a window i +/- 50m/z</FONT></P>
			<P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">if,
			s[i] <FONT FACE="Courier 10 Pitch">&gt;</FONT> &micro;+&sigma;,
			add to new array with s2'[i] = s[i]-(&micro;-&sigma;), set in
			original s[i] = 0.</FONT></P>
			<LI><P STYLE="margin-bottom: 0in">&forall;<FONT FACE="courier new, monospace">i
			&isin; <FONT FACE="courier new, monospace">m/z in array s</FONT>,</FONT></P>
			<P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">compute
			the intensity &sigma;,&micro; in a window i +/- 50m/z</FONT></P>
			<P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">if,
			s[i] <FONT FACE="Courier 10 Pitch">&gt;</FONT> &micro;+2&sigma;,
			add to new array with s2'[i] = s[i]-(&micro;-&sigma;).</FONT></P>
			<LI><P STYLE="margin-bottom: 0in; font-style: normal"><FONT FACE="courier new, monospace">Replace
			s with s2' as new spectrum array.</FONT></P>
		</OL>
		<LI><P STYLE="margin-bottom: 0in; font-style: normal">Keep the top
		200 abundant peaks(by peak intensity) in spectrum array, remove
		others.</P>
		<LI><P STYLE="margin-bottom: 0in; font-style: normal">Normalize the
		200 peaks, so that the max peak intensity equals 100. 
		</P>
		<LI><P STYLE="margin-bottom: 0in">Equalize peak intensity in
		increasing m/z order,</P>
		<OL TYPE=a>
			<P STYLE="margin-bottom: 0in">&forall;<FONT FACE="courier new, monospace">continuous
			block of peaks(no zero intensity within the block),</FONT></P>
			<OL TYPE=a>
				<P STYLE="margin-bottom: 0in"><FONT FACE="courier new, monospace">max_intensity
				= max peak intensity in the continuous block,</FONT></P>
				<P STYLE="margin-bottom: 0in">&forall;<FONT FACE="courier new, monospace">i
				&isin; peak location(m/z) in block, </FONT>
				</P>
				<OL TYPE=a>
					<P STYLE="margin-bottom: 0in"><FONT FACE="courier new, monospace">S[i]
					= max_intensity</FONT></P>
				</OL>
			</OL>
		</OL>
	</OL>
</OL>
<P>2.&nbsp; Predict fragment ions, use B and Y ions, limit the
maximum fragment-ion-charge to (precursor-ion-charge -1), if
precursor-ion-charge == +1, set max to +1 . 
</P>
<P>3.&nbsp; Calculate the <FONT FACE="courier new, monospace">Normalized_intensity_sum.
</FONT>
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">For each predicted fragment ion,
	if there is a matching m/z peak in the processed observed spectrum,
	add the matching peak's intensity. 
	</P>
	<LI><P STYLE="margin-bottom: 0in">The total summation off all the
	matching peak's intensities, equal the <FONT FACE="courier new, monospace">Normalized_intensity_sum.</FONT></P>
</UL>
<P>4. Calculate Sp,</P>
<P>&nbsp; <FONT FACE="courier new, monospace">Sp =
Normalized_intensity_sum * <I>n</I>i * (1 + m*BETA) / <I>n</I>t &nbsp;&nbsp;
&nbsp;</FONT></P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <I>n</I>i&nbsp; = the number
of predicted fragment ions that have a matching peak</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <I>n</I>t = the total number
of predicted fragmented ions</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; m = continuity count of an
ion series, ex, if B2-B3-B4 Y3-Y4 match, than m=3</P>
<P>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BETA = 0.075 
</P>
<P><BR><BR>
</P>
<HR>
<P><CODE><B><FONT SIZE=4><FONT FACE="Courier, monospace">Comments</FONT></FONT></B></CODE></P>
<P><SPAN ID="Frame1" DIR="LTR" STYLE="float: left; width: 4.88in; height: 3.38in; border: none; padding: 0in; background: #ffffff">
	<P STYLE="margin-top: 0.08in; margin-bottom: 0.08in"><IMG SRC="images/Sequest-vs-CRUX-for-sprun-both.png" NAME="graphics2" ALIGN=LEFT WIDTH=99% BORDER=0><BR CLEAR=LEFT><FONT SIZE=2><I>figure
	1: CRUX vs Sequest on all top 500 matches</I></FONT></P>
</SPAN><BR CLEAR=LEFT><BR><BR>
</P>
<P><SPAN ID="Frame2" DIR="LTR" STYLE="float: left; width: 4.98in; height: 3.52in; border: none; padding: 0in; background: #ffffff">
	<P STYLE="margin-top: 0.08in; margin-bottom: 0.08in"><IMG SRC="images/Sequest-vs-CRUX-for-sp.png" NAME="graphics1" ALIGN=LEFT WIDTH=100% BORDER=0><BR CLEAR=LEFT><FONT SIZE=2><I>figure2:
	CRUX vs Sequest on top 5 Xcorr ranked peptides</I></FONT></P>
</SPAN><BR CLEAR=LEFT><BR><BR>
</P>
<P><BR><BR>
</P>
<UL>
	<LI><P>In the step 10, equalize peak, do not equalize the very last
	peak in the spectrum array. I believe it is a Sequest bug.</P>
	<LI><P>When iterating through the spectrum array, always iterate in
	increasing m/z order. 
	</P>
	<LI><P>In step 7, when calculating  <SPAN STYLE="font-style: normal"><FONT FACE="courier new, monospace">&sigma;,&micro;,
	</FONT></SPAN>
	</P>
	<UL>
		<LI><P STYLE="font-style: normal"><FONT FACE="courier new, monospace">&micro;
		= total_intensity / (m/z window -1), in our case (m/z window) = 101</FONT></P>
		<LI><P STYLE="font-style: normal"><FONT FACE="courier new, monospace">&sigma;
		= sqrt(sum{(s[i] -  &micro;)^2}/ (m/z window))</FONT></P>
	</UL>
</UL>
<P><BR><BR><BR><BR><BR><BR>
</P>
</BODY>
</HTML>