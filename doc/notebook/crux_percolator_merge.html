<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OOo-dev 2.0  (Linux)">
	<META NAME="CREATED" CONTENT="20070611;14101900">
	<META NAME="CHANGED" CONTENT="20070613;15005000">
	<STYLE>
	<!--
		@page { size: 8.5in 11in; margin: 0.79in }
		P { margin-bottom: 0.08in }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P STYLE="margin-bottom: 0in"><CODE><B><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Percolator
incorporation plan</FONT></FONT></B></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><B><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Percolator
feature generation.</FONT></FONT></B></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Divided
percolator features into spectrum, match and run specific features.</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">1.
Match specific features:</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE>&nbsp;&nbsp;&nbsp;<FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">Xcorr,
Sp, ln(rSp), Mass, &#8710;<CODE>Mass:(observed - calculated),
abs(</CODE></FONT><CODE><CODE>&#8710;</CODE><FONT SIZE=3 STYLE="font-size: 13pt">Mass),
Fraction of b&amp;y ion match, </FONT></CODE></FONT></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE>&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">enzN:N-term
tryptic?, enzC:C-term tryptic?, enzInt:number of missed cleavage
sites, </FONT></FONT></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE>&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">charge1~3:
charge state</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">2.
Spectrum specific features:</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE>&nbsp;&nbsp;&nbsp;<CODE>&#8710;</CODE><FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">Cn,
</FONT><CODE>&#8710;</CODE><FONT SIZE=3 STYLE="font-size: 13pt">Cln,
ln(NumSp):log of number peptide in mass range</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">3.
Run-specific features (i.e. features that are derived from multiple
spectra):</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">ln(numPep),
ln(numProt), ln(pepSite)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">The
</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">spectrum
and match</FONT></FONT></SPAN></CODE></CODE> features are stored in
the following structs,</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">struct
match_collection{</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_T*
match[_MAX_NUMBER_PEPTIDES]; ///&lt; array of match object</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">BOOLEAN_T
scored_type[_SCORE_TYPE_NUM]; ///&lt; has the score type been
computed in each match</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">int
match_total; ///&lt; total_match_count</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace"><CODE><SPAN STYLE="text-decoration: none">SPECTRUM_FEATURES_T</SPAN></CODE>*
features &lt;---------------- </FONT></FONT><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Spectrum
specific features</FONT></FONT></CODE></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">}</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">struct
match{</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">SPECTRUM_T*
spectrum; ///&lt; the spectrum we are scoring with</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">PEPTIDE_T*
peptide; ///&lt; the peptide we are scoring</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">float
match_scores[_SCORE_TYPE_NUM]; ///&lt; the scoring result array (use
enum_type SCORER_TYPE_T to index)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">int
match_rank[_SCORE_TYPE_NUM]; ///&lt; the rank of scoring result (use
enum_type SCORER_TYPE_T to index)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<CODE><FONT SIZE=3 STYLE="font-size: 13pt"><SPAN STYLE="text-decoration: none"><FONT FACE="Courier, monospace">MATCH_FEATURES_T*</FONT></SPAN>
<FONT FACE="Courier, monospace">features</FONT> &lt;----------------
</FONT><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Match
specific features</FONT></FONT></CODE></CODE></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">}</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P><BR><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">The
run-specific features are either not considered in <B>Plan B</B>, or
will be incorporated after PSM scoring, through a separate object
&ldquo;feature_vector&rdquo; in <B>Plan A</B>.</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><B><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Plan
A.</FONT></FONT></B></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">In
plan A, the database search and Percolator interface are clearly
decoupled.</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">The
Percolator interface can be run separately on PSM feature-vector
output files, which allows more straight forward parallelization for
potential cluster usage. However, the code complexity increases with
more bookkeeping (e.g. keeping track of PSM identifications) and a
data serialization step.</FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Key
functions:</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Serialize
the match and spectrum features of the PSM</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">void
serialize_percolator_features(</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">FILE*
output, //&lt; PSM database output file</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_T*
match, //&lt; match features to be serialized</FONT></FONT></SPAN></CODE></CODE></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
<CODE>match_collection </CODE></FONT></FONT></SPAN><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//&lt;
match_collection features to be serialized</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">//
Instantiate rich_match_collection object from PSM output files in the
user specified directory.</FONT></FONT></P>
<P STYLE="margin-bottom: 0in"><FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">//
The  rich_match_collection will contain rich_match objects that is a
extension of a match(PSM) plus peptide, spectrum features.</FONT></FONT></P>
<P STYLE="margin-bottom: 0in"><FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">//
In addition, the rich_match_collection object will use hash tables to
keep track of multiple hits </FONT></FONT>
</P>
<P STYLE="margin-bottom: 0in"><FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">//
on peptides and proteins from the PSM results. Overall, the 
rich_match_collection object is</FONT></FONT></P>
<P STYLE="margin-bottom: 0in"><FONT FACE="Courier, monospace"><FONT SIZE=3 STYLE="font-size: 13pt">//
a bridging object from database search result to PSM features.</FONT></FONT></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">RICH_MATCH_COLLECTION_T*
new_rich_match_collection(</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;</SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">FILE**
output //&lt; All the PSM output files in the specified directory.</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Generate
run specific features from the</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//RICH_MATCH_COLLECTION
that is instantiated from the output file</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">void
process_run_specific_features(</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">RICH_MATCH_COLLECTION_T*
rich_match_collection</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Returns
f</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">loat
array in the Percolator input format.</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">float*
get_percolator_features(</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;</SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">RICH_MATCH_T*
rich_match</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">)</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">/***************</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">*
pseudo-code</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">***************/</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//top_match_collection
will store all top ranked PSMs</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
top_</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection
= new_match_collection();</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection;</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">int
keep_top_rank = 5 </FONT></FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">FILE*
output;</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
spectrum:</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//generates
a match_collection from the spectrum </FONT></FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection
= new_</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection(spectrum);</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//serialize
the PSM's match &amp; spectrum features to output </FONT></FONT></SPAN></CODE></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
top_match in match_collection upto keep_top_rank:</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">serialize_percolator_features(output,
<CODE>top_match, </CODE></FONT></FONT></SPAN><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection);</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//free
match_collection</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">free(</FONT></FONT></FONT></SPAN><FONT SIZE=3 STYLE="font-size: 13pt"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection)</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">/*************second
part maybe a separate execution using the output
file*****************/</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//create
feature_vector object and read in the output PSM results.</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">RICH_MATCH_COLLECTION_T*
<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">rich_match_collection
= </FONT></FONT></SPAN></CODE>new_rich_match_collection(psm_result_</FONT></FONT></SPAN></CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">folder);</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Process
PSM output and generate the run specific features</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">process_run_specific_features(<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">rich_match_collection</FONT></FONT></SPAN></CODE>);</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//create
iterator, to register each PSM feature to Percolator</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">RICH_MATCH_ITERATOR_T*
rich_match_iterator = new_rich_match_iterator(rich_match_collection</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">);</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
rich_match in </FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">rich_match_iterator:</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;</SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Register
PSM with features to Percolator</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">pcRegisterPSM(get_sequence(<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">rich_match</FONT></FONT></SPAN></CODE>),
get_percolator_features(<CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">rich_match</FONT></FONT></SPAN></CODE>));</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P><BR><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><B><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Plan
B.</FONT></FONT></B></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">In
plan B, database search and Percolator interface are run together.
W<SPAN STYLE="text-decoration: none">hen it is time to register PSMs,
u<FONT FACE="Courier, monospace">se &ldquo;</FONT><SPAN STYLE="text-decoration: none"><CODE><FONT FACE="Courier, monospace">get_percolator_features&rdquo;
method that takes a match and its match_collection as </FONT></CODE><FONT FACE="Courier, monospace">a</FONT>rguments
and returns a float array in the Percolator input format. No
intermediate output files are created. However, because the PSMs from
the entire run are not stored, run specific features will not be used
for Percolator.</SPAN></SPAN></FONT></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">float*
get_percolator_features(</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_T*
match</FONT></FONT></SPAN></CODE> <FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">,</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">Match_collection_t*
</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">)</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">/***************</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">*
pseudo-code</FONT> search_spectra </FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">***************/</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//top_match_collection
will store all top ranked PSMs</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT FACE="Courier, monospace"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
top_</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection
= new_match_collection();</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><FONT FACE="Courier, monospace"><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">MATCH_COLLECTION_T*
</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection;</FONT></FONT></SPAN></CODE></FONT></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">int
keep_top_rank = 5</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
spectrum:</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//generates
a match_collection from the spectrum </FONT></FONT></SPAN></CODE>
</P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection
= new_</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection(spectrum);</FONT></FONT></SPAN></CODE></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">foreach
top_match in match_collection upto keep_top_rank:</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//Register
PSM with features to Percolator</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">pcRegisterPSM(get_sequence(top_match),
get_percolator_features(top_match, match_collection))</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//transfers
the #top rank matches to top_match_collection</FONT></FONT></SPAN></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">transfer_match(top_match_collection,
</FONT></FONT></SPAN></CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection,
</FONT></FONT></SPAN><CODE><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">keep_top_rank);</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">//free
match_collection</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><CODE><SPAN STYLE="text-decoration: none">&nbsp;&nbsp;&nbsp;<FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">free(</FONT></FONT></SPAN><CODE><SPAN STYLE="text-decoration: none"><FONT SIZE=3 STYLE="font-size: 13pt"><FONT FACE="Courier, monospace">match_collection)</FONT></FONT></SPAN></CODE></CODE></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<HR>
<P><BR><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
</BODY>
</HTML>